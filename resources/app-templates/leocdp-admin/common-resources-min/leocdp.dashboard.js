'use strict';var mainDashboardFunnelHeight=420,mainDashboardWidth=860,dashboardFontSize=14,flowNetworkGraph=!1,dashboardDataModel=!1,currentJourneyMapId="",initPrimaryDashboard=function(){window.mainDashboardFunnelHeight=420;window.mainDashboardWidth=860;window.dashboardFontSize=14;window.flowNetworkGraph=!1;window.dashboardDataModel=!1;window.currentJourneyMapId="";loadJourneyMapList(!1,function(a){currentJourneyMapId=a;showDashboardReport(!0)},!0);setupTabPanels();updateProfileChartWrapper();initDateFilterComponent(!1,
null,null,45);showDashboardReport(!0)},updateProfileChartWrapper=function(){var a=$("#profile_funnel_wrapper"),d=$(window).width();1500<d&&1650>d?a.css("width","90%"):1650<d&&1750>d?a.css("width","96%"):1750<d&&a.css("width","98%");a=$(window).height();var c=d/a;1.7<=c&&2.3>c&&1400<d&&700<a?(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+186),dashboardFontSize=15):2.3<=c&&1400<d&&700<a&&(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+116),dashboardFontSize=16);mainDashboardWidth=
0<window.pageWrapperWidth?.7*window.pageWrapperWidth:mainDashboardWidth},showDashboardReport=function(a){var d=getDateFilterValues(),c=d.beginFilterDate;$("#beginReportDate").text((new moment(c)).format(defaultDateFormat));c=d.endFilterDate;$("#endReportDate").text((new moment(c)).format(defaultDateFormat));var f={block:{highlight:!0,fill:{type:"gradient"}},chart:{curve:{enabled:!0,height:33},height:mainDashboardFunnelHeight,bottomWidth:.64,bottomPinch:2,width:4*mainDashboardFunnelHeight/3},tooltip:{enabled:!0},
label:{fontSize:dashboardFontSize+"px"},events:{click:{block:function(b){console.log(b.label.raw)}}}},l=function(){var b=dashboardDataModel.profileTotalStats;$("#profile_total_stats").empty();$("#marketing_metrics_holder").empty();$("#sales_metrics_holder").empty();$("#cx_metrics_holder").empty();for(var h=0;h<b.length;h++){var e=b[h],g=e.collectorKey,k=e.collectorCount;e=e.flowType;0===e?$("#profile_total_stats").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+k+" \x3c/div\x3e"):1===e?$("#marketing_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+
g+" : "+k+" \x3c/div\x3e"):2===e?$("#sales_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+k+" \x3c/div\x3e"):3===e&&$("#cx_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+k+" \x3c/div\x3e")}b=dashboardDataModel.profileFunnelData;h=[];for(g=0;g<b.length;g++){k=b[g];e=(new Number(k.collectorCount)).toLocaleString();var m=getColorCodeProfileFunnel(g+1);h.push([k.collectorKey,e,m])}(new D3Funnel("#profile_funnel")).draw(h,f);$("#profile_journey_funnel").empty();
b=dashboardDataModel.journeyStatsData;0!==b.length&&(b={labels:journeyLabel5A,subLabels:["VISITOR PROFILE","CONTACT PROFILE"],colors:[["#D6EAF8","#85C1E9","#3498DB"],["#B7F0B7","#8CF08C","#5CF45C"]],values:b},h=$("#profile_journey_funnel").parent().width(),(new FunnelGraph({container:"#profile_journey_funnel",gradientDirection:"horizontal",data:b,displayPercent:!0,direction:"horizontal",width:h,height:350,subLabelValue:"percent"})).draw())};!1===dashboardDataModel||!0===a?($("#primary_dashboard_loader").show(),
$("#primary_dashboard").hide(),d.journeyMapId=currentJourneyMapId,LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/dashboard-primary",d,function(b){$("#primary_dashboard_loader").hide();$("#primary_dashboard").show();0===b.httpCode&&""===b.errorMessage?(dashboardDataModel=b.data,l()):LeoAdminApiUtil.logErrorPayload(b)})):l()};
function showTouchpointHubReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var d=$("#observer_report_wrapper");d.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",a,function(c){if("object"===typeof c.data&&""===c.errorMessage){var f=mainDashboardWidth;f=$("\x3ccanvas/\x3e").width(f).height(620);showProfileEventBubbleChart("Touchpoint Hub Report",
d,f,c.data);$("#observer_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:c.data,fields:[{name:"name",title:"Touchpoint Hub",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(c)})}
function showTouchpointItemReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var d=$("#touchpoint_report_wrapper");d.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",a,function(c){if("object"===typeof c.data&&""===c.errorMessage){var f=mainDashboardWidth;f=$("\x3ccanvas/\x3e").width(f).height(720);showProfileEventBubbleChart("Touchpoint Item Report",
d,f,c.data,"touchpoint");c=c.data.map(function(l){var b=l.touchpoint.url.trim();0===b.indexOf("http")&&(b='\x3ca target\x3d"_blank" href\x3d"'+b+'" title\x3d"'+b+'"\x3e'+l.touchpoint.name+"\x3cbr\x3e"+textTruncate(b,55)+"\x3c/a\x3e",l.touchpoint.name=b);return l});$("#touchpoint_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:c,fields:[{name:"touchpoint.name",title:"Touchpoint Item",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",
width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(c)})};
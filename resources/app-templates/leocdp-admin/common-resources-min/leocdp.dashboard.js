'use strict';var mainDashboardFunnelHeight=420,mainDashboardWidth=860,dashboardFontSize=14,flowNetworkGraph=!1,dashboardDataModel=!1,currentJourneyMapId="",initPrimaryDashboard=function(){window.mainDashboardFunnelHeight=420;window.mainDashboardWidth=860;window.dashboardFontSize=14;window.flowNetworkGraph=!1;window.dashboardDataModel=!1;window.currentJourneyMapId="";loadJourneyMapList(!1,function(a){currentJourneyMapId=a;showDashboardReport(!0)},!0);setupTabPanels();updateProfileChartWrapper();initDateFilterComponent(!1,
null,null,45);showDashboardReport(!0)},updateProfileChartWrapper=function(){var a=$("#profile_funnel_wrapper"),c=$(window).width();1500<c&&1650>c?a.css("width","90%"):1650<c&&1750>c?a.css("width","96%"):1750<c&&a.css("width","98%");a=$(window).height();var b=c/a;1.7<=b&&2.3>b&&1400<c&&700<a?(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+186),dashboardFontSize=15):2.3<=b&&1400<c&&700<a&&(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+116),dashboardFontSize=16);mainDashboardWidth=
0<window.pageWrapperWidth?.7*window.pageWrapperWidth:mainDashboardWidth},showDashboardReport=function(a){var c=getDateFilterValues(),b=c.beginFilterDate;$("#beginReportDate").text((new moment(b)).format(defaultDateFormat));b=c.endFilterDate;$("#endReportDate").text((new moment(b)).format(defaultDateFormat));var f={block:{highlight:!0,fill:{type:"gradient"}},chart:{curve:{enabled:!0,height:33},height:mainDashboardFunnelHeight,bottomWidth:.64,bottomPinch:2,width:4*mainDashboardFunnelHeight/3},tooltip:{enabled:!0},
label:{fontSize:dashboardFontSize+"px"},events:{click:{block:function(d){console.log(d.label.raw)}}}},k=function(){var d=dashboardDataModel.profileTotalStats;$("#profile_total_stats").empty();$("#marketing_metrics_holder").empty();$("#sales_metrics_holder").empty();$("#cx_metrics_holder").empty();for(var l=0;l<d.length;l++){var e=d[l],g=e.collectorKey,h=e.collectorCount.toLocaleString("en-US");e=e.flowType;0===e?$("#profile_total_stats").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+h+" \x3c/div\x3e"):
1===e?$("#marketing_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+h+" \x3c/div\x3e"):2===e?$("#sales_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+h+" \x3c/div\x3e"):3===e&&$("#cx_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+g+" : "+h+" \x3c/div\x3e")}d=dashboardDataModel.profileFunnelData;l=[];for(g=0;g<d.length;g++){h=d[g];e=(new Number(h.collectorCount)).toLocaleString();var m=getColorCodeProfileFunnel(g+1);l.push([h.collectorKey,
e,m])}(new D3Funnel("#profile_funnel")).draw(l,f)};!1===dashboardDataModel||!0===a?($("#primary_dashboard_loader").show(),$("#primary_dashboard").hide(),c.journeyMapId=currentJourneyMapId,LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/dashboard-primary",c,function(d){$("#primary_dashboard_loader").hide();$("#primary_dashboard").show();0===d.httpCode&&""===d.errorMessage?(dashboardDataModel=d.data,k()):LeoAdminApiUtil.logErrorPayload(d)})):k()};
function updateJourneyDashboard(){$("#profile_journey_funnel").empty();reportJourneyOfAllProfiles("#profile_journey_funnel",dashboardDataModel.journeyStatsData)}
function showTouchpointHubReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var c=$("#observer_report_wrapper");c.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",a,function(b){if("object"===typeof b.data&&""===b.errorMessage){var f=mainDashboardWidth;f=$("\x3ccanvas/\x3e").width(f).height(620);showProfileEventBubbleChart("Touchpoint Hub Report",
c,f,b.data);$("#observer_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:b.data,fields:[{name:"name",title:"Touchpoint Hub",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(b)})}
function showTouchpointItemReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var c=$("#touchpoint_report_wrapper");c.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",a,function(b){if("object"===typeof b.data&&""===b.errorMessage){var f=mainDashboardWidth;f=$("\x3ccanvas/\x3e").width(f).height(720);showProfileEventBubbleChart("Touchpoint Item Report",
c,f,b.data,"touchpoint");b=b.data.map(function(k){var d=k.touchpoint.url.trim();0===d.indexOf("http")&&(d='\x3ca target\x3d"_blank" href\x3d"'+d+'" title\x3d"'+d+'"\x3e'+k.touchpoint.name+"\x3cbr\x3e"+textTruncate(d,55)+"\x3c/a\x3e",k.touchpoint.name=d);return k});$("#touchpoint_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:b,fields:[{name:"touchpoint.name",title:"Touchpoint Item",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",
width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(b)})};
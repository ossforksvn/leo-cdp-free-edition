'use strict';var mainDashboardFunnelHeight=420,mainDashboardWidth=860,dashboardFontSize=14,flowNetworkGraph=!1,dashboardDataModel=!1,currentJourneyMapId="",initPrimaryDashboard=function(){window.mainDashboardFunnelHeight=420;window.mainDashboardWidth=860;window.dashboardFontSize=14;window.flowNetworkGraph=!1;window.dashboardDataModel=!1;window.currentJourneyMapId="";loadJourneyMapList(!1,function(a){currentJourneyMapId=a;showDashboardReport(!0)},!0);setupTabPanels();updateProfileChartWrapper();initDateFilterComponent(!1,
null,null,45);showDashboardReport(!0)},updateProfileChartWrapper=function(){var a=$("#profile_funnel_wrapper"),c=$(window).width();1500<c&&1650>c?a.css("width","90%"):1650<c&&1750>c?a.css("width","96%"):1750<c&&a.css("width","98%");a=$(window).height();var f=c/a;1.7<=f&&2.3>f&&1400<c&&700<a?(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+186),dashboardFontSize=15):2.3<=f&&1400<c&&700<a&&(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+116),dashboardFontSize=16);mainDashboardWidth=
0<window.pageWrapperWidth?.7*window.pageWrapperWidth:mainDashboardWidth},showDashboardReport=function(a){var c=getDateFilterValues(),f=c.beginFilterDate;$("#beginReportDate").text((new moment(f)).format(defaultDateFormat));f=c.endFilterDate;$("#endReportDate").text((new moment(f)).format(defaultDateFormat));var d={block:{highlight:!0,fill:{type:"gradient"}},chart:{curve:{enabled:!0,height:33},height:mainDashboardFunnelHeight,bottomWidth:.64,bottomPinch:2,width:4*mainDashboardFunnelHeight/3},tooltip:{enabled:!0},
label:{fontSize:dashboardFontSize+"px"},events:{click:{block:function(b){console.log(b.label.raw)}}}},h=function(){var b=dashboardDataModel.profileTotalStats;$("#profile_total_stats").empty();$("#marketing_metrics_holder").empty();$("#sales_metrics_holder").empty();$("#cx_metrics_holder").empty();for(var e=0;e<b.length;e++){var g=b[e],k=g.collectorKey,l=g.collectorCount;g=g.flowType;0===g?$("#profile_total_stats").append('\x3cdiv class\x3d"stats_item" \x3e '+k+" : "+l+" \x3c/div\x3e"):1===g?$("#marketing_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+
k+" : "+l+" \x3c/div\x3e"):2===g?$("#sales_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+k+" : "+l+" \x3c/div\x3e"):3===g&&$("#cx_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+k+" : "+l+" \x3c/div\x3e")}b=dashboardDataModel.profileFunnelData;e=[];for(k=0;k<b.length;k++){l=b[k];g=(new Number(l.collectorCount)).toLocaleString();var m=getColorCodeProfileFunnel(k+1);e.push([l.collectorKey,g,m])}(new D3Funnel("#profile_funnel")).draw(e,d);$("#profile_journey_funnel").empty();
b=dashboardDataModel.journeyStatsData;0!==b.length&&(b={labels:journeyLabel5A,subLabels:["VISITOR PROFILE","CONTACT PROFILE"],colors:[["#D6EAF8","#85C1E9","#3498DB"],["#B7F0B7","#8CF08C","#5CF45C"]],values:b},e=$("#profile_journey_funnel").parent().width(),(new FunnelGraph({container:"#profile_journey_funnel",gradientDirection:"horizontal",data:b,displayPercent:!0,direction:"horizontal",width:e,height:350,subLabelValue:"percent"})).draw())};!1===dashboardDataModel||!0===a?($("#primary_dashboard_loader").show(),
$("#primary_dashboard").hide(),c.journeyMapId=currentJourneyMapId,LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/dashboard-primary",c,function(b){$("#primary_dashboard_loader").hide();$("#primary_dashboard").show();0===b.httpCode&&""===b.errorMessage?(dashboardDataModel=b.data,h(),showTouchpointHubReport(c,"observer_report_wrapper"),setTimeout(function(){showTouchpointItemReport(c,"touchpoint_report_wrapper")},3E3)):LeoAdminApiUtil.logErrorPayload(b)})):h()};
function showTouchpointHubReport(a,c){var f=$("#"+c);f.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",a,function(d){if("object"===typeof d.data&&""===d.errorMessage){var h=mainDashboardWidth;h=$("\x3ccanvas/\x3e").width(h).height(620);showProfileEventBubbleChart("Touchpoint Hub Report",f,h,d.data);$("#observer_report_table").jsGrid({editing:!1,paging:!1,
width:"100%",height:"auto",data:d.data,fields:[{name:"name",title:"Touchpoint Hub",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(d)})}
function showTouchpointItemReport(a,c){var f=$("#"+c);f.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=25;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",a,function(d){if("object"===typeof d.data&&""===d.errorMessage){var h=mainDashboardWidth;h=$("\x3ccanvas/\x3e").width(h).height(720);showProfileEventBubbleChart("Touchpoint Item Report",f,h,d.data,"touchpoint");d=d.data.map(function(b){var e=b.touchpoint.url.trim();
0===e.indexOf("http")&&(e='\x3ca target\x3d"_blank" href\x3d"'+e+'" title\x3d"'+e+'"\x3e'+b.touchpoint.name+"\x3cbr\x3e"+textTruncate(e,55)+"\x3c/a\x3e",b.touchpoint.name=e);return b});$("#touchpoint_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:d,fields:[{name:"touchpoint.name",title:"Touchpoint Item",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",
width:60}]})}else LeoAdminApiUtil.logErrorPayload(d)})};
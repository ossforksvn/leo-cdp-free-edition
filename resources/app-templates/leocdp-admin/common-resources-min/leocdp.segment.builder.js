'use strict';const getTouchpointHubHosts=function(g){var f={};for(const [c,a]of Object.entries(g))if(0===c.indexOf("http"))try{var l=(new URL(c)).host.replace("www.","");f[l]=a}catch(d){console.error(c),console.error(d)}return f},afterUpdateQueryBuilder=function(g,f){if("datepicker"===f.filter.plugin){g=f.$el.find(".rule-value-container input");f=f.operator.type;f="compare_month_and_day_with_now"===f||"compare_year_month_day_with_now"===f;var l=moment.utc().local().format("YYYY-MM-DD"),c=g.val();
f&&""===c&&g.val(l);console.log("afterUpdateQueryBuilder "+g.val());g.datepicker("update")}},buildSegmentDateFilter=function(g,f,l){return{id:g,label:f,type:"date",placeholder:"yyyy-mm-dd",validation:{format:"yyyy-mm-dd",allow_empty_value:!1},valueSetter:function(c,a){a="object"===typeof a?a:[];console.log("buildSegmentDateFilter.valueSetter ",a);0<a.length&&(a[0]=moment.utc(a[0]).local().format("YYYY-MM-DD"),a[1]=moment.utc(a[1]).local().format("YYYY-MM-DD"),c.$el.find(".rule-value-container input").each(function(d){$(this).val([a[d]]).css("width",
"100px").datepicker("update")}))},valueGetter:function(c){var a=[];c=c.$el.find(".rule-value-container input").each(function(){var d=$(this).css("width","100px").val().trim();""!==d&&a.push(moment(d).utc().local().format("YYYY-MM-DD").valueOf())});console.log("buildSegmentDateFilter.valueGetter ",a);c.attr("autocomplete","off").focus(function(){var d=$(this).offset().top+$(this).height()+8;$("div.datepicker-dropdown").css("top",d)});return 1===a.length?a[0]:a},plugin:"datepicker",plugin_config:{format:"yyyy-mm-dd",
todayBtn:"linked",todayHighlight:!0,autoclose:!0,orientation:"bottom"},operators:getOperatorsForDateField(),optgroup:l}},buildSegmentProductFilter=function(g,f,l){return{id:g,label:f,type:"string",validation:{allow_empty_value:!1},valueSetter:function(c,a){1==c.operator.nb_inputs&&(a=[a]);c.$el.find(".rule-value-container input").each(function(d){$(this).val(a).css("width","220px")})},valueGetter:function(c){var a="";c.$el.find(".rule-value-container input").each(function(){a=$(this).val()});return a},
input:function(c,a){c='\x3ci class\x3d"fa fa-fw fa-search"\x3e\x3c/i\x3e\x3cinput placeholder\x3d"Item ID" class\x3d"form-control product_search" type\x3d"text" name\x3d"'+a+'"\x3e';setTimeout(function(){$('input.product_search[name\x3d"'+a+'"]').focus(function(){console.log("TODO open dialog search product by keywords, then return product ID")})},1E3);return c},operators:["contains_any","not_contains_any"],optgroup:l}},buildTouchpointFilter=function(g,f,l){return{id:g,label:f,type:"string",validation:{allow_empty_value:!1},
valueSetter:function(c,a){1==c.operator.nb_inputs&&(a=[a]);c.$el.find(".rule-value-container input").each(function(d){$(this).val(a).css("width","220px")})},valueGetter:function(c){var a="";c.$el.find(".rule-value-container input").each(function(){a=$(this).val()});return a},input:function(c,a){c='\x3ci class\x3d"fa fa-fw fa-search"\x3e\x3c/i\x3e\x3cinput placeholder\x3d"Touchpoint ID" class\x3d"form-control touchpoint_search" type\x3d"text" name\x3d"'+a+'"\x3e';setTimeout(function(){$('input.touchpoint_search[name\x3d"'+
a+'"]').focus(function(){console.log("TODO open dialog search touchpoint by keywords, then return touchpoint ID")})},1E3);return c},operators:["contains_any","not_contains_any"],optgroup:l}},buildSegmentJourneyFilter=function(g,f,l,c){return{id:g,label:f,type:"string",valueSetter:function(a,d){a.$el.find(".rule-value-container select").each(function(e){$(this).val(d[e]).trigger("change")})},valueGetter:function(a){var d=[];a.$el.find(".rule-value-container select").each(function(){d.push($(this).val())});
return d},input:function(a,d){var e='\x3cselect class\x3d"form-control segmentation_journey_map" \x3e';c.forEach(function(b){e+='\x3coption value\x3d"'+b.id+'" \x3e'+b.name+"\x3c/option\x3e"});e+='\x3c/select\x3e \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e ';e+='\x3cselect class\x3d"form-control" \x3e \x3coption value\x3d"1"\x3e AWARENESS \x3c/option\x3e \x3coption value\x3d"2"\x3e ATTRACTION \x3c/option\x3e \x3coption value\x3d"3"\x3e ASK \x3c/option\x3e ';return e+=' \x3coption value\x3d"4"\x3e ACTION \x3c/option\x3e \x3coption value\x3d"5"\x3e ADVOCACY \x3c/option\x3e \x3c/select\x3e'},
operators:["in_journey_map"],optgroup:l}},buildSegmentNumberSlider=function(g,f,l,c,a,d,e){return{id:g,label:f,type:"integer",validation:{min:l,max:c,step:a},operators:getOperatorsForNumberField(),plugin:"slider",plugin_config:{min:l,max:c,value:d,tooltip:"always"},valueSetter:function(b,h){1==b.operator.nb_inputs&&(h=[h]);b.$el.find(".rule-value-container input").each(function(m){$(this).slider("setValue",h[m]||0)})},valueGetter:function(b){var h=[];b.$el.find(".rule-value-container input").each(function(){h.push($(this).slider("getValue"))});
return 1==b.operator.nb_inputs?h[0]:h},optgroup:e}},segmentFiltersForCX=[buildSegmentNumberSlider("totalCFS","Total CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("positiveCFS","Positive CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("neutralCFS","Neutral CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("negativeCFS","Negative CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("totalCES","Total CES",
0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("positiveCES","Positive CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("neutralCES","Neutral CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("negativeCES","Negative CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("totalCSAT","Total CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("positiveCSAT","Positive CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),
buildSegmentNumberSlider("neutralCSAT","Neutral CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("negativeCSAT","Negative CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("totalNPS","Total NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("positiveNPS","Positive NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("neutralNPS","Neutral NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("negativeNPS",
"Negative NPS",0,100,1,0,"NPS - Net Promoter Score")],segmentFiltersForCustomerValue=[{id:"totalTransactionValue",label:"Total Transaction Value",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalLoyaltyScore",label:"Total Loyalty Score",type:"integer",validation:{step:1,min:0},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalCreditScore",label:"Customer Credit Score",type:"integer",validation:{min:0,max:100,
step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"rfeScore",label:"RFE Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"rfmScore",label:"RFM Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"churnScore",label:"Churn Score",type:"double",validation:{min:-100,max:100,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"}],
advancedSegmentFilters=[{id:"receiveWebPush",label:"Receive Web Notification",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveAppPush",label:"Receive App Notification",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveEmail",label:"Receive Email Marketing",
type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveSMS",label:"Receive Mobile SMS",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveAds",label:"Receive Retargeting Ads",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal",
"not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"personalProblems",label:"Personal Problems",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"personalInterests",label:"Personal Interests",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"solutionsForCustomer",label:"Solutions For Customer",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"nextBestActions",
label:"Next Best Actions",type:"string",operators:["contains_any","not_contains_any"],input:"select",values:{"read-contents":"READ CONTENTS","buy-some-items":"BUY SOME ITEMS","subscribe-a-service":"SUBSCRIBE A SERVICE","checkout-items-in-cart":"CHECKOUT ITEMS IN CART","checkin-location":"CHECKIN LOCATION","play-a-game":"PLAY A GAME","take-a-course":"TAKE A COURSE","watch-a-video":"WATCH A VIDEO","take-a-trip":"TAKE A TRIP","read-a-book":"READ A BOOK"},optgroup:"Marketing Information"},{id:"mediaChannels",
label:"Reachable Media Channel",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"contentKeywords",label:"Content Keywords",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"productKeywords",label:"Product Keywords",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"}],loadSegmentBuilder=function(g,f,l,c,a){var d=function(e,b,h,m){var k=[{id:"dataContext",label:"Data Context",
type:"integer",input:"radio",values:{1:"Production Data",0:"Test Data","-1":"Fake Data"},operators:["equal","not_equal"],optgroup:"Basic Profile Information"},{id:"type",label:"Profile Type",type:"integer",input:"select",values:{0:"ANONYMOUS_VISITOR",1:"LOGIN_USER_CONTACT",2:"CUSTOMER_CONTACT",3:"STUDENT_CONTACT",4:"CRM_IMPORTED_CONTACT",5:"DIRECT_INPUT_CONTACT",6:"INFLUENCER_CONTACT",7:"CLIENT_CONTACT",8:"B2B_PARTNER_CONTACT",9:"EMPLOYEE_CONTACT",10:"KEY_ACCOUNT_CONTACT",11:"SYSTEM_USER_CONTACT"},
operators:["equal","not_equal"],optgroup:"Basic Profile Information"},{id:"funnelStage",label:"Data Funnel Stage",type:"string",input:"select",values:{"new-visitor":"New Visitor","returning-visitor":"Returning Visitor",lead:"Lead",prospect:"Prospect","new-customer":"New Customer","engaged-customer":"Engaged Customer","happy-customer":"Happy Customer","customer-advocate":"Customer Advocate","unhappy-customer":"Unhappy Customer","terminated-customer":"Terminated Customer"},operators:["equal","not_equal"],
optgroup:"Basic Profile Information"},buildSegmentJourneyFilter("cdp_profile__inJourneyMaps","Data Journey Map","Basic Profile Information",m),buildSegmentNumberSlider("dataQualityScore","Data Quality Score",0,maxTotalDataQualityScore,1,0,"Basic Profile Information"),{id:"dataLabels",label:"Data Labels",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Basic Profile Information"},buildSegmentDateFilter("createdAt","Created Date","Basic Profile Information"),buildSegmentDateFilter("updatedAt",
"Updated Date","Basic Profile Information"),{id:"_key",label:"Profile ID",type:"string",operators:["equal","not_equal"],optgroup:"Profile Key Information"},{id:"visitorId",label:"Web Visitor ID",type:"string",operators:"equal not_equal is_empty is_not_empty is_null is_not_null".split(" "),optgroup:"Profile Key Information"},{id:"fingerprintId",label:"Fingerprint ID",type:"string",operators:"equal not_equal is_empty is_not_empty is_null is_not_null".split(" "),optgroup:"Profile Key Information"},{id:"crmRefId",
label:"Imported CRM ID",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"primaryEmail",label:"Primary Email",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"primaryPhone",label:"Primary Phone",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"primaryUsername",label:"Primary Username",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},
{id:"governmentIssuedIDs",label:"Citizen/Passport IDs",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Profile Key Information"},{id:"applicationIDs",label:"Application IDs",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Profile Key Information"},{id:"totalLeadScore",label:"Total Lead Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalProspectScore",label:"Total Prospect Score",
type:"integer",validation:{step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalEngagementScore",label:"Customer Engagement Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalCAC",label:"Customer Acquisition Cost",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalCLV",label:"Customer Lifetime Value",type:"double",validation:{step:.01},
operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"firstName",label:"First Name",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"lastName",label:"Last Name",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"primaryNationality",label:"Primary Nationality",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"permanentLocation",label:"Permanent Location Address",
type:"string",operators:["contains"],optgroup:"Personal Information"},{id:"livingLocation",label:"Living Location Address",type:"string",operators:["contains"],optgroup:"Personal Information"},{id:"livingCity",label:"Living City",type:"string",operators:["contains"],optgroup:"Personal Information"},{id:"livingState",label:"Living State",type:"string",operators:["contains"],optgroup:"Personal Information"},buildSegmentNumberSlider("age","Age",0,150,1,0,"Personal Information"),buildSegmentDateFilter("dateOfBirth",
"Date of Birth","Personal Information"),{id:"gender",label:"Gender",type:"integer",input:"radio",values:{0:"Female",1:"Male",7:"Unknown"},operators:["equal","not_equal"],optgroup:"Personal Information"},buildSegmentNumberSlider("genderProbability","Gender Probability",0,100,1,0,"Personal Information"),buildTouchpointFilter("topEngagedTouchpointIds","Top Engaged Touchpoints","Data Sources"),{id:"trackingevent__srcTouchpointUrl",field:"cdp_trackingevent__srcTouchpointUrl",label:"Source Touchpoint URL",
type:"string",input:"select",values:e,operators:["data_from","data_contains"],optgroup:"Data Sources"},{id:"referrerChannels",label:"Web Referrer Channel",type:"string",input:"select",values:getTouchpointHubHosts(e),operators:["has_key","not_has_key"],optgroup:"Data Sources"},{id:"lastTouchpoint__name",label:"Last Touchpoint Name",type:"string",operators:["sub_field_contains","sub_field_equals"],optgroup:"Data Sources"},{id:"lastTouchpoint__url",label:"Last Touchpoint URL",type:"string",operators:["sub_field_contains",
"sub_field_equals"],optgroup:"Data Sources"},{id:"lastSeenIp",label:"Last Seen IP Address",type:"string",operators:["equal"],optgroup:"Data Sources"},{id:"saleAgencies",label:"Sales Agency / Sales Source",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Sale Sources"},{id:"saleAgents",label:"Sales Agent / Sales Person",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Sale Sources"},{id:"softSkills",label:"Soft Skills",type:"string",operators:["contains_any",
"not_contains_any"],optgroup:"Education"},{id:"learningHistory",label:"Learning History",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Education"},{id:"studyCertificates",label:"Study Certificates",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Education"},{id:"jobTitles",label:"Job Title",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Working Experience"},{id:"workingHistory",label:"Working History",type:"string",operators:["contains_any",
"not_contains_any"],optgroup:"Working Experience"},{id:"businessIndustries",label:"Business Industry",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Working Experience"},{id:"cdp_trackingevent__transactionId",label:"Transaction ID",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionValue",label:"Transaction Value",type:"double",validation:{step:.01},operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},
{id:"cdp_trackingevent__transactionStatus",label:"Transaction Status",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionCode",label:"Transaction Code",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionDiscount",label:"Transaction Discount",type:"double",validation:{step:.01},operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionCurrency",
label:"Transaction Currency",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionPayment",label:"Transaction Payment",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"behavioralEvents",label:"Behavioral Event Metrics",type:"string",input:"select",values:b,operators:["contains_any","not_contains_any"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__metricName",label:"Event Metric Name",
type:"string",operators:getOperatorsForStringEqualityField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__metricValue",label:"Event Metric Value",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__timeSpent",label:"Time Spent in seconds",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__fingerprintId",label:"Web Fingerprint ID",type:"string",operators:["data_equals","data_contains"],
optgroup:"Behavioural Event"},buildSegmentDateFilter("cdp_trackingevent__createdAt","Event Creation Date","Behavioural Event"),buildSegmentDateFilter("cdp_trackingevent__updatedAt","Event Modification Date","Behavioural Event"),{id:"cdp_trackingevent__srcTouchpointName",label:"Source from Touchpoint Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__srcTouchpointUrl",label:"Source from Touchpoint URL",type:"string",operators:["data_equals",
"data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refTouchpointName",label:"Referrer from Touchpoint Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refTouchpointUrl",label:"Referrer from Touchpoint URL",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__locationName",label:"Event from Location Name",type:"string",operators:["data_equals","data_contains"],
optgroup:"Behavioural Event"},{id:"cdp_trackingevent__locationCode",label:"Event from Location Code",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__sourceIP",label:"Event from Source IP",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refCampaignId",label:"Event from Campaign ID",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__environment",
label:"Data Environment",type:"string",input:"select",values:{pro:"In Production",qctest:"In QC Test",dev:"In Development"},operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__fraudScore",label:"Fraud Score",type:"integer",operators:["data_equals"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__deviceType",label:"Device Type",type:"string",operators:getOperatorsForStringEqualityField(),input:"radio",values:{General_Desktop:"Desktop PC",General_Mobile:"Mobile",
General_Tablet:"Tablet"},optgroup:"Device Information"},{id:"cdp_trackingevent__deviceId",label:"Device ID",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"cdp_trackingevent__deviceName",label:"Device Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"cdp_trackingevent__deviceOS",label:"Device OS",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"lastUsedDeviceId",label:"Last Used Device ID",
type:"string",operators:["equal"],optgroup:"Device Information"},buildSegmentProductFilter("shoppingItemsIds","Shopping Item ID","Product Information"),buildSegmentProductFilter("purchasedItemIds","Purchased Item ID","Product Information")];h.forEach(function(n){k.push({id:"assetGroup_"+n.id,field:"behavioralEvents",label:"Events in Asset Group: "+n.title,type:"string",input:"select",values:n.eventNamesForSegmentation,operators:["contains_any","not_contains_any"],optgroup:"Behavioral Events in Asset Group"})});
k=k.concat(advancedSegmentFilters);k=k.concat(segmentFiltersForCustomerValue);return k=k.concat(segmentFiltersForCX)};LeoAdminApiUtil.getSecuredData("/cdp/journeymap/list-all-for-segmentation",{},function(e){if(0===e.httpCode&&""===e.errorMessage){e=e.data;var b=c||!1,h=$("#segment-builder-holder"),m=h.queryBuilder,k=_.union(getOperatorsForStringField(),getOperatorsForNumberField());k.push({type:"compare_month_and_day",nb_inputs:1,multiple:!0,apply_to:["date"]});k.push({type:"compare_month_and_day_between",
nb_inputs:2,multiple:!0,apply_to:["date"]});k.push({type:"compare_month_and_day_with_now",nb_inputs:0,multiple:!0,apply_to:["date"]});k.push({type:"compare_year_month_day_with_now",nb_inputs:0,multiple:!0,apply_to:["date"]});k.push({type:"contains_any",optgroup:"List Operator",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});k.push({type:"not_contains_any",optgroup:"List Operator",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});k.push({type:"has_key",optgroup:"Key Operator",
nb_inputs:1,multiple:!0,apply_to:["string"]});k.push({type:"not_has_key",optgroup:"Key Operator",nb_inputs:1,multiple:!0,apply_to:["string"]});k.push({type:"sub_field_contains",optgroup:"Sub Field",nb_inputs:1,multiple:!0,apply_to:["string"]});k.push({type:"sub_field_equals",optgroup:"Sub Field",nb_inputs:1,multiple:!0,apply_to:["string"]});k.push({type:"data_equals",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});k.push({type:"data_less_than",optgroup:"Data Filter",
nb_inputs:1,multiple:!0,apply_to:["string","number"]});k.push({type:"data_equals_or_less_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});k.push({type:"data_greater_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});k.push({type:"data_equals_or_greater_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});k.push({type:"data_contains",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});
k.push({type:"data_from",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});k.push({type:"in_journey_map",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});m.call(h,{plugins:["bt-tooltip-errors"],operators:k,filters:d(g,f,l,e),rules:b}).on("afterUpdateRuleValue.queryBuilder",afterUpdateQueryBuilder);"function"===typeof a&&a()}else LeoAdminApiUtil.logErrorPayload(e)})},refreshAllSegments=function(){LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/segments/refresh",
{},function(g){iziToast.success({timeout:3E3,icon:"fa fa-check-square-o",title:"Segment Data Refresh",message:"Total updated segment: \x3cb\x3e"+g.data+"\x3c/b\x3e",onClosing:function(f,l,c){location.reload(!0)}})})},deleteSegment=function(){if("object"===typeof segmentDataModel&&""!=window.segmentDataModel.id){$("#delete_callback").val("");$("#confirmDeleteParentChildDialog").modal({focus:!0});$("#deleteChildItemMsg").text("Delete all profiles and related data in this segment ! (Be Careful)");$("#deleteChildItemCheckbox").prop("checked",
!1);$("#deleteChildItem").show();var g="deleteSegment"+segmentDataModel.id;window[g]=function(){var f=baseLeoAdminUrl+"/cdp/segment/delete",l=$("#deleteChildItemCheckbox").is(":checked");iziToast.info({title:"Data Deletion",message:'Start the job to delete the segment "'+segmentDataModel.name+'"'});LeoAdminApiUtil.callPostAdminApi(f,{id:segmentDataModel.id,deleteAllProfiles:l},function(c){if(0===c.httpCode){var a=c.data;0<=a?($("#deleteChildItem").hide(),$("#deleteChildItemMsg").text(""),iziToast.success({title:"OK",
message:'Successfully deleted the segment "'+segmentDataModel.name+'". Total deleted profile: '+a,onClosing:function(d,e,b){location.hash="calljs-leoCdpRouter('Segment_Management')"}})):iziToast.error({title:"Error",message:c.data,onClosing:function(d,e,b){location.reload(!0)}})}else $("#error-on-save").html(c.errorMessage).show().delay(5E3).fadeOut("slow"),LeoAdminApiUtil.logErrorPayload(c)})};$("#delete_parent_callback").val(g);$("#deletedParentInfoTitle").html(segmentDataModel.name);$("#deletedParentInfoMsg").html("Do you want to delete the segment ?")}},
loadProfileViewForSegmentParams=function(g){var f=$("#segment-builder-holder").queryBuilder("getRules");g.jsonQueryRules="object"===typeof f?JSON.stringify(f):"";g.realtimeQuery=!0;g.segmentId=segmentDataModel.id;console.log("loadProfileViewForSegmentParams",f);return JSON.stringify(g)},loadProfilesInSegment=function(g){var f=$("#profile_list_querybuilder");"object"===typeof segmentDataModel&&(!0===g?(segmentDataModel.realtimeQuery=!0,f.DataTable().clear(),f.DataTable().ajax.reload()):loadProfileViewForSegment(f,
"/cdp/segment/profile-query-builder"))},loadProfileViewForSegment=function(g,f){var l=[{render:function(a,d,e){d="Web Visitor";try{"function"===typeof initPersonalizationInSegment&&setTimeout(function(){initPersonalizationInSegment(e.id)},3999);var b=e.firstName||"",h=e.lastName||"";if(0<b.length||0<h.length)d=textTruncate(b+" "+h,32)}catch(m){console.log(m)}return'\x3cdiv style\x3d"font-size:13.5px;"\x3e\x3ca target\x3d"_blank" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+
(a+"')\" \x3e")+d+"\x3c/a\x3e\x3c/div\x3e"},targets:0,orderable:!1},{render:function(a,d,e){a=profileContactTypes[a].replace("_CONTACT","");return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:10.8px;"\x3e\x3ca target\x3d"_blank" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(e.id+"')\" \x3e"+a+"\x3c/a\x3e\x3c/div\x3e")},targets:1,orderable:!1},{render:function(a,d,e){d="-";0===a?d='\x3ci class\x3d"fa fa-female"\x3e\x3c/i\x3e Female':1===a?d='\x3ci class\x3d"fa fa-male"\x3e\x3c/i\x3e Male':
2<=a&&6>=a&&(d="LGBT");return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:10.8px;" \x3e'+d+"\x3c/div\x3e"},targets:2,orderable:!1},{render:function(a,d,e){return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" \x3e\x3ca title\x3d"Profile Email" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(e.id+"')\" \x3e"+textTruncate("string"===typeof a?a:"-",24)+"\x3c/a\x3e\x3c/div\x3e")},targets:3,orderable:!1},{render:function(a,d,e){return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" \x3e\x3ca title\x3d"Profile Phone" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+
(e.id+"')\" \x3e"+textTruncate("string"===typeof a?a:"-",20)+"\x3c/a\x3e\x3c/div\x3e")},targets:4,orderable:!1},{render:function(a,d,e){a=e.lastTouchpoint?e.lastTouchpoint.name:"";return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" title\x3d"'+a+'" \x3e'+textTruncate(a,45)+"\x3c/div\x3e"},targets:5,orderable:!1},{render:function(a,d,e){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+a+"\x3c/div\x3e"},targets:6,orderable:!1},{render:function(a,d,e){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+
a+"\x3c/div\x3e"},targets:7,orderable:!1},{render:function(a,d,e){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+a+"\x3c/div\x3e"},targets:8,orderable:!1},{render:function(a,d,e){return a?'\x3cdiv class\x3d"small"\x3e'+moment.utc(a).local().format("YYYY-MM-DD HH:mm:ss")+"\x3c/div\x3e":""},targets:9,orderable:!1}],c=getUserSession();"string"===typeof c&&g.DataTable({lengthMenu:[[20,30,50],[20,30,50]],processing:!0,serverSide:!0,searching:!1,serverMethod:"POST",ajax:{url:f,contentType:"application/json",
beforeSend:function(a){a.setRequestHeader("leouss",c)},data:loadProfileViewForSegmentParams},columnDefs:l,columns:[{data:"id"},{data:"type"},{data:"gender"},{data:"primaryEmail"},{data:"primaryPhone"},{data:"lastTouchpoint"},{data:"dataQualityScore"},{data:"totalLeadScore"},{data:"totalCLV"},{data:"updatedAt"}]})},loadSegmentListByFilter=function(g,f,l,c,a){var d=[{data:"id"},{data:"name"},{data:"totalCount"},{data:"description"},{data:"ownerUsername"},{data:"createdAt"},{data:"updatedAt"}],e=getUserSession();
if(e)return $(l).DataTable({lengthMenu:[[20,30,40],[20,30,40]],processing:!0,serverSide:!0,searching:!0,search:{return:!0},ordering:!0,serverMethod:"POST",ajax:{url:baseLeoAdminUrl+"/cdp/segments/filter",contentType:"application/json",beforeSend:function(b){$(f).show();$(g).hide();b.setRequestHeader("leouss",e)},data:function(b){var h=b.order[0];b.sortField=d[h.column].data;b.sortAsc="asc"===h.dir;b.searchValue=b.search.value;delete b.order;delete b.search;"function"===typeof c&&(b=c(b));return JSON.stringify(b)},
dataSrc:function(b){var h=b.canInsertData,m=b.canEditData,k=b.canDeleteData;$(l).data("canInsertData",h);$(l).data("canEditData",m);$(l).data("canDeleteData",k);"function"===typeof a&&a(b);$(f).hide();$(g).show();return b.data}},columnDefs:[{render:function(b,h,m){return""},targets:0,orderable:!1},{render:function(b,h,m){h="#calljs-leoCdpRouter('Segment_Details','"+m.id+"')";m=textTruncate(b,50);return'\x3cdiv class\x3d"segment_name_in_list"\x3e \x3cmark\x3e \x3ca title\x3d"Segment Name: '+b+'" href\x3d"'+
h+'" \x3e'+m+"\x3c/a\x3e \x3c/mark\x3e\x3c/div\x3e"},targets:1},{render:function(b,h,m){b=b.toLocaleString();return'\x3cdiv class\x3d"segment_size " style\x3d"min-width:95px; font-size:14.2px" title\x3d"The size of segment: '+b+'" \x3e\x3cmark\x3e'+b+"\x3c/mark\x3e\x3c/div\x3e"},targets:2},{render:function(b,h,m){return'\x3cdiv  style\x3d"font-size:0.8em;" title\x3d"'+b+'" \x3e'+textTruncate(b,150)+"\x3c/div\x3e"},targets:3,orderable:!1},{render:function(b,h,m){return'\x3cdiv style\x3d"min-width:90px; text-align:center" \x3e'+
b+"\x3c/div\x3e"},targets:4,orderable:!1},{render:function(b,h,m){return'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;min-width:80px" \x3e'+moment.utc(b).local().format("YYYY-MM-DD HH:mm:ss")+"\x3c/div\x3e"},targets:5},{render:function(b,h,m){return b?'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;min-width:80px" \x3e'+moment.utc(b).local().format("YYYY-MM-DD HH:mm:ss")+"\x3c/div\x3e":"-"},targets:6},{render:function(b,h,m){b='\x3ca class\x3d"control" title\x3d"Segment Report" href\x3d"#calljs-leoCdpRouter(\'Segment_Details\',\''+
(m.id+'\')" \x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e View\x3c/a\x3e');$(l).data("canEditData")&&(b+='\x3cbr\x3e \x3ca class\x3d"control" title\x3d"Segment Builder" href\x3d"#calljs-leoCdpRouter(\'Segment_Builder\',\''+(m.id+'\')" \x3e \x3ci class\x3d"fa fa-pencil-square-o" aria-hidden\x3d"true"\x3e\x3c/i\x3e Edit\x3c/a\x3e '));return b},targets:7}],columns:d,order:[[6,"desc"]]})};